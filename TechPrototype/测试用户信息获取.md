# 测试用户信息获取功能

## 测试目标

验证后端能够正确获取userId=1的用户信息，并在本人车票页面显示真实的用户和乘客信息。

## 测试步骤

### 1. 检查数据库中的用户数据

首先确认数据库中userId=1的用户信息：

```sql
-- 查询用户信息
SELECT * FROM users WHERE user_id = 1;

-- 查询关联的乘客信息
SELECT p.* FROM passengers p 
JOIN users u ON p.passenger_id = u.passenger_id 
WHERE u.user_id = 1;
```

### 2. 测试API接口

使用Postman或curl测试API：

```bash
# 获取用户车票信息
curl "http://localhost:8080/api/ticket/my-tickets?userId=1"
```

预期响应应该包含：
- `userInfo` 字段，包含真实的用户和乘客信息
- `tickets` 字段，包含该用户的车票列表

### 3. 验证前端显示

1. 启动前端服务：`cd mini-12306 && npm start`
2. 访问本人车票页面
3. 验证页面顶部显示的用户信息是否与数据库中的信息一致

## 预期结果

### API响应示例
```json
{
  "status": "SUCCESS",
  "message": "获取成功",
  "tickets": [...],
  "userInfo": {
    "userId": 1,
    "realName": "张三",  // 来自users表
    "phoneNumber": "13800138000",  // 来自users表
    "email": "zhangsan@example.com",  // 来自users表
    "passengerId": 327,  // 来自users表的passenger_id
    "passengerName": "张三",  // 来自passengers表
    "passengerIdCard": "110101199001011234",  // 来自passengers表
    "passengerPhone": "13800138000"  // 来自passengers表
  },
  "timestamp": "2025-07-04T10:30:00"
}
```

### 前端显示
页面顶部应该显示：
- 姓名：张三
- 身份证号：110101199001011234
- 手机号：13800138000

## 故障排除

### 1. 如果用户不存在
错误信息：`用户不存在`
解决方案：确保数据库中存在userId=1的用户记录

### 2. 如果用户未关联乘客
错误信息：`用户未关联乘客信息`
解决方案：确保users表中userId=1的记录的passenger_id字段不为空

### 3. 如果乘客信息不存在
错误信息：`乘客信息不存在`
解决方案：确保passengers表中存在对应的乘客记录

### 4. 如果前端显示"未知"
可能原因：
- 后端返回的userInfo字段为空
- 前端解析userInfo时出错
- 数据库中的字段值为null

## 数据验证SQL

```sql
-- 验证用户和乘客关联关系
SELECT 
    u.user_id,
    u.real_name as user_name,
    u.phone_number as user_phone,
    u.email as user_email,
    u.passenger_id,
    p.real_name as passenger_name,
    p.id_card_number as passenger_id_card,
    p.phone_number as passenger_phone
FROM users u
LEFT JOIN passengers p ON u.passenger_id = p.passenger_id
WHERE u.user_id = 1;

-- 验证该用户的车票数量
SELECT COUNT(*) as ticket_count
FROM tickets t
JOIN users u ON t.passenger_id = u.passenger_id
WHERE u.user_id = 1;
```

## 测试用例

### 测试用例1：正常情况
- 输入：userId=1
- 预期：返回完整的用户信息和车票列表
- 验证：前端正确显示用户信息

### 测试用例2：用户不存在
- 输入：userId=999
- 预期：返回错误信息"用户不存在"
- 验证：前端显示错误提示

### 测试用例3：用户未关联乘客
- 输入：userId=1（但该用户的passenger_id为null）
- 预期：返回错误信息"用户未关联乘客信息"
- 验证：前端显示错误提示

### 测试用例4：按状态筛选
- 输入：userId=1, ticketStatus=1
- 预期：返回未使用状态的车票和用户信息
- 验证：只显示未使用的车票，用户信息正确显示 