# 席别选择修复说明

## 问题描述

用户反映在提交订单页面选择了不同的席别（如商务座、二等座、一等座），但后端日志显示所有乘客都使用了商务座（carriageTypeId=1）。

## 问题原因

1. **前端UI设计**：允许每个乘客独立选择不同的席别
2. **后端API限制**：`BookingRequest`只支持所有乘客使用同一个席别
3. **前端请求构建**：没有正确传递用户选择的席别信息

## 修复方案

### 1. 前端修复
- 检测用户是否选择了不同的席别
- 使用第一个乘客选择的席别作为所有乘客的席别
- 显示警告信息告知用户席别已统一

### 2. 代码修改
```javascript
// 使用第一个乘客选择的席别作为所有乘客的席别
const firstPassengerSeatType = passengerSeatTypes[0];
const carriageTypeId = seatTypeToCarriageId[firstPassengerSeatType];

// 检查所有乘客是否选择了相同的席别
const differentSeatTypes = passengerSeatTypes.filter(seatType => seatType !== firstPassengerSeatType);
if (differentSeatTypes.length > 0) {
    message.warning(`检测到不同席别选择，将统一使用 ${firstPassengerSeatType}`);
}
```

## 测试步骤

### 1. 正常情况测试
1. 进入提交订单页面
2. 选择多个乘客
3. 为所有乘客选择相同的席别（如都选择商务座）
4. 提交订单
5. 验证后端日志显示正确的席别

### 2. 不同席别测试
1. 进入提交订单页面
2. 选择多个乘客
3. 为不同乘客选择不同的席别（如乘客A选择商务座，乘客B选择二等座）
4. 提交订单
5. 验证前端显示警告信息
6. 验证后端使用第一个乘客的席别

### 3. 验证修复效果
- 前端正确传递席别信息到后端
- 后端日志显示正确的carriageTypeId
- 用户收到清晰的提示信息

## 后续优化建议

### 1. 后端支持独立席别
- 修改`BookingRequest.PassengerInfo`添加`carriageTypeId`字段
- 修改后端处理逻辑支持每个乘客独立席别

### 2. 前端UI优化
- 添加席别一致性检查
- 提供席别统一选项
- 显示席别价格差异

### 3. 用户体验改进
- 在席别选择时显示价格差异
- 提供席别推荐功能
- 添加席别说明和限制

## 相关文件

- `mini-12306/src/pages/SubmitOrder/index.jsx` - 前端提交订单页面
- `src/main/java/com/example/techprototype/DTO/BookingRequest.java` - 后端请求DTO
- `src/main/java/com/example/techprototype/Service/Impl/TicketServiceImpl.java` - 后端购票服务 