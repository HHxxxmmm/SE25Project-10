# 提交订单功能测试说明

## 功能概述

提交订单功能是购票流程中的关键步骤，用户在此页面可以：
1. 查看车次信息（车次号、出发站、到达站、时间等）
2. 查看席别信息和价格
3. 选择乘车人
4. 为每个乘车人选择票种、席别、证件类型等（根据乘客类型限制票种选择）
5. 提交订单进入支付流程

## 票种选择规则

### 乘客类型与票种限制
- **成人（1）**: 只能购买成人票
- **儿童（2）**: 只能购买儿童票
- **学生（3）**: 可以购买成人票或学生票
- **残疾（4）**: 可以购买成人票或残疾票
- **军人（5）**: 可以购买成人票或军人票

### 票种价格优惠
- **成人票**: 全价
- **儿童票**: 5折优惠
- **学生票**: 7.5折优惠
- **残疾票**: 免费
- **军人票**: 免费

## 后端API

### 准备提交订单API
- **接口地址**: `POST /api/prepare-order/prepare`
- **请求参数**:
```json
{
  "userId": 1,
  "inventoryIds": [1, 11, 21]
}
```
- **响应格式**: 包含车次信息、席别信息、乘客信息等

## 前端实现

### 内置测试参数
前端代码中已内置测试参数：
- `userId`: 1
- `inventoryIds`: [1, 11, 21]

### 主要功能
1. **数据加载**: 页面加载时自动调用后端prepareorder API获取数据
2. **车次信息展示**: 显示车次号、出发站、到达站、时间、日期
3. **席别信息展示**: 显示商务座、一等座、二等座及其价格
4. **乘客选择**: 从后端获取用户关联的乘客列表供选择
5. **乘客类型显示**: 在乘客列表中显示每个乘客的类型
6. **票种限制**: 根据乘客类型动态限制可选择的票种
7. **乘客详情配置**: 为每个乘客配置票种、席别、证件类型、证件号码
8. **订单提交**: 生成订单号并跳转到支付页面

## 测试步骤

### 1. 访问提交订单页面
```
http://localhost:3000/submit-order
```

### 2. 验证数据加载
- 页面应显示加载状态
- 加载完成后显示车次信息
- 显示用户关联的乘客列表
- 每个乘客后面显示乘客类型

### 3. 验证车次信息
- 车次号: G101
- 出发站: 北京南
- 到达站: 上海虹桥
- 出发时间: 09:00
- 到达时间: 14:30
- 出发日期: 2025-07-04

### 4. 验证席别信息
- 商务座: ¥553元
- 一等座: ¥553元
- 二等座: ¥553元

### 5. 选择乘客
- 勾选一个或多个乘客
- 验证乘客详情表格显示
- 验证乘客类型列显示正确

### 6. 验证票种限制
- **成人乘客**: 票种选择框只显示"成人票"
- **儿童乘客**: 票种选择框只显示"儿童票"
- **学生乘客**: 票种选择框显示"成人票"和"学生票"
- **残疾乘客**: 票种选择框显示"成人票"和"残疾票"
- **军人乘客**: 票种选择框显示"成人票"和"军人票"

### 7. 配置乘客信息
- 选择票种（根据乘客类型限制）
- 选择席别（商务座、一等座、二等座）
- 选择证件类型（居民身份证）
- 填写证件号码

### 8. 提交订单
- 点击"提交订单"按钮
- 验证跳转到支付页面
- 验证URL包含订单号参数

## 票种限制测试用例

### 1. 成人乘客测试
- 选择成人乘客
- 验证票种选择框只显示"成人票"
- 验证无法选择其他票种

### 2. 儿童乘客测试
- 选择儿童乘客
- 验证票种选择框只显示"儿童票"
- 验证无法选择其他票种

### 3. 学生乘客测试
- 选择学生乘客
- 验证票种选择框显示"成人票"和"学生票"
- 验证可以在这两种票种间切换

### 4. 残疾乘客测试
- 选择残疾乘客
- 验证票种选择框显示"成人票"和"残疾票"
- 验证可以在这两种票种间切换

### 5. 军人乘客测试
- 选择军人乘客
- 验证票种选择框显示"成人票"和"军人票"
- 验证可以在这两种票种间切换

## 错误处理

### 1. API调用失败
- 显示错误提示
- 自动跳转到车次列表页面

### 2. 数据格式错误
- 显示错误提示
- 保持当前页面状态

### 3. 网络异常
- 显示网络错误提示
- 提供重试选项

## 调试信息

### 控制台日志
- 获取准备订单信息的请求参数
- 准备订单信息的响应数据
- 生成的订单号
- 跳转支付页面的URL

### 网络请求
- 请求URL: `POST /api/prepare-order/prepare`
- 请求体: `{"userId": 1, "inventoryIds": [1, 11, 21]}`
- 响应状态: 200 OK
- 响应数据: 包含车次、席别、乘客信息

## 注意事项

1. **测试参数固定**: 当前使用固定的测试参数，实际应用中应从URL参数或状态管理获取
2. **席别选项固定**: 当前使用固定的席别选项，实际应用中应从后端响应动态生成
3. **价格固定**: 当前使用固定价格，实际应用中应从后端响应获取
4. **订单号生成**: 当前使用简单的时间戳生成，实际应用中应使用更复杂的算法
5. **支付页面跳转**: 当前使用window.location.href，实际应用中应使用React Router
6. **票种限制**: 根据乘客类型动态限制可选择的票种，确保业务规则正确执行

## 后续优化

1. **动态参数**: 支持从URL参数获取userId和inventoryIds
2. **动态席别**: 根据后端响应动态生成席别选项
3. **动态价格**: 根据后端响应显示实际价格
4. **表单验证**: 添加更严格的表单验证
5. **错误重试**: 添加网络错误重试机制
6. **加载优化**: 优化加载状态和错误状态显示
7. **票种验证**: 在后端添加票种选择的业务规则验证
8. **价格计算**: 根据票种类型动态计算实际价格 