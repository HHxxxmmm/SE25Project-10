# 订单页面前后端对接测试说明

## 功能概述

订单页面实现了完整的前后端对接，包括：
- 获取用户的所有订单列表
- 支持多种过滤条件（订单号、车次号、状态、日期范围）
- 显示订单详细信息（车次、时间、金额等）
- 支持订单操作（支付、取消、查看详情）

## 前端实现

### 1. API服务
- 使用`orderAPI`模块统一管理订单相关API
- 支持条件查询和基础查询
- 包含完整的错误处理和加载状态

### 2. 数据适配
- 适配后端`MyOrderResponse`数据结构
- 字段映射：`orderId`、`orderNumber`、`orderTime`等
- 状态映射：0-待支付、1-已支付、2-已完成、3-已取消

### 3. 界面功能
- 搜索表单：订单号、车次号、状态、日期范围
- 订单列表：显示订单基本信息和车次信息
- 操作按钮：根据订单状态显示不同操作
- 分页功能：支持大量订单数据的分页显示

## 后端实现

### 1. API接口
```java
// 获取我的订单
@GetMapping("/my")
public MyOrderResponse getMyOrders(@RequestParam Long userId)

// 根据条件获取我的订单
@GetMapping("/my/filter")
public MyOrderResponse getMyOrdersByConditions(
    @RequestParam Long userId,
    @RequestParam(required = false) String orderNumber,
    @RequestParam(required = false) LocalDate startDate,
    @RequestParam(required = false) LocalDate endDate,
    @RequestParam(required = false) Byte orderStatus,
    @RequestParam(required = false) String trainNumber)
```

### 2. 数据查询
- 根据用户ID查询订单列表
- 支持多种过滤条件组合查询
- 按订单时间倒序排列
- 获取订单关联的车票和车次信息

### 3. 响应数据结构
```java
public static class MyOrderInfo {
    // 订单基本信息
    private Long orderId;
    private String orderNumber;
    private LocalDateTime orderTime;
    private BigDecimal totalAmount;
    private Byte orderStatus;
    private String orderStatusText;
    private String paymentMethod;
    private LocalDateTime paymentTime;
    
    // 车次信息
    private Integer trainId;
    private String trainNumber;
    private LocalDate departureDate;
    private LocalTime departureTime;
    private LocalTime arrivalTime;
    private String departureStationName;
    private String departureCity;
    private String arrivalStationName;
    private String arrivalCity;
    
    // 车票数量
    private Integer ticketCount;
}
```

## 测试步骤

### 1. 准备测试数据
确保数据库中有以下数据：
- 用户信息（userId=1）
- 订单信息（与用户关联）
- 车票信息（与订单关联）
- 车次和车站信息

### 2. 启动服务
```bash
# 启动后端服务
mvn spring-boot:run

# 启动前端服务
cd mini-12306
npm start
```

### 3. 测试流程

#### 步骤1：访问订单页面
- 打开浏览器访问：`http://localhost:3000/orders`
- 确认页面正常加载，显示订单列表

#### 步骤2：测试基础查询
- 确认页面显示所有订单
- 验证订单信息正确显示：
  - 订单号和下单时间
  - 订单状态和颜色
  - 车次信息和路线
  - 乘车人数和总金额

#### 步骤3：测试过滤功能
- **订单号过滤**：输入订单号进行搜索
- **车次号过滤**：输入车次号进行搜索
- **状态过滤**：选择不同订单状态
- **日期范围过滤**：选择下单时间范围

#### 步骤4：测试订单操作
- **待支付订单**：测试"立即支付"和"取消订单"按钮
- **已支付订单**：测试"查看详情"按钮
- **已完成订单**：测试"查看详情"按钮
- **已取消订单**：测试"重新预订"按钮

### 4. 验证要点

#### 数据正确性
- [ ] 订单基本信息正确
- [ ] 车次信息正确
- [ ] 时间信息正确
- [ ] 金额信息正确
- [ ] 状态信息正确

#### 过滤功能
- [ ] 订单号过滤正常
- [ ] 车次号过滤正常
- [ ] 状态过滤正常
- [ ] 日期范围过滤正常
- [ ] 组合过滤正常

#### 界面交互
- [ ] 加载状态正常显示
- [ ] 错误信息正确提示
- [ ] 分页功能正常
- [ ] 按钮操作正常

#### 响应式设计
- [ ] 大屏幕布局正常
- [ ] 中等屏幕布局正常
- [ ] 小屏幕布局正常
- [ ] 手机屏幕布局正常

## 常见问题

### 1. 订单页面无法加载
- 检查后端服务是否正常启动
- 检查数据库连接是否正常
- 检查用户ID是否正确

### 2. 过滤功能不工作
- 确认API路径正确
- 检查参数格式是否正确
- 验证后端查询逻辑

### 3. 订单信息显示异常
- 检查字段映射是否正确
- 确认后端返回的数据格式
- 验证时间格式化函数

### 4. 操作按钮无响应
- 检查事件处理函数
- 确认API调用是否正确
- 验证权限验证逻辑

## 技术要点

### 1. 前后端数据一致性
- 使用统一的字段命名
- 确保数据类型匹配
- 处理空值和异常情况

### 2. 错误处理
- 前端：网络错误、数据错误、权限错误
- 后端：数据库错误、业务逻辑错误、参数错误

### 3. 性能优化
- 前端：合理使用useCallback和useEffect
- 后端：优化数据库查询，避免N+1问题

### 4. 用户体验
- 加载状态提示
- 错误信息友好显示
- 操作反馈及时

## 总结

订单页面成功实现了前后端对接，提供了完整的订单管理功能。通过合理的API设计、数据适配和错误处理，确保了功能的稳定性和用户体验的良好性。支持多种过滤条件和操作功能，满足了用户的实际需求。 