# 添加乘车人功能测试说明

## 功能概述
本测试集合用于验证乘车人管理功能，包括检查是否可以添加乘车人和添加乘车人两个主要功能。

## 功能改进

### 1. 弹窗权限检查
- **改进前**: 点击"添加乘车人"按钮直接打开弹窗
- **改进后**: 点击按钮时先检查用户是否可以添加乘车人，只有允许时才打开弹窗
- **效果**: 达到上限的用户无法打开添加乘车人弹窗

### 2. 详细错误提示
- **达到上限**: "已达到最大乘车人数量限制（3人），无法继续添加"
- **重复添加**: "该乘车人已被添加，请勿重复添加"
- **信息无效**: "该乘车人信息无效，请检查姓名、身份证号和手机号是否正确"
- **用户错误**: "用户信息错误，请重新登录"

## API接口

### 1. 检查是否可以添加乘车人
- **接口**: `GET /api/passenger/check-add/{userId}`
- **功能**: 检查指定用户是否可以添加乘车人（未满3人）
- **返回**: 
  - `allowed: true` - 可以添加
  - `allowed: false` - 不可以添加，并返回原因

### 2. 添加乘车人
- **接口**: `POST /api/passenger/add`
- **参数**: 
  ```json
  {
    "userId": 用户ID,
    "realName": "真实姓名",
    "idCardNumber": "身份证号",
    "phoneNumber": "手机号"
  }
  ```

## 测试用例

### 弹窗权限检查测试

#### 1. 用户1（已满3人）- 应该无法打开弹窗
- **测试步骤**: 点击"添加乘车人"按钮
- **预期结果**: 显示警告消息"已达到最大乘车人数量限制（3人）"，弹窗不打开

#### 2. 用户2（0人）- 应该可以打开弹窗
- **测试步骤**: 点击"添加乘车人"按钮
- **预期结果**: 正常打开添加乘车人弹窗

#### 3. 用户3（1人）- 应该可以打开弹窗
- **测试步骤**: 点击"添加乘车人"按钮
- **预期结果**: 正常打开添加乘车人弹窗

### 添加功能测试

#### 1. 添加成人乘客（用户2）
- **姓名**: 郑永军
- **身份证号**: 531318196507019109
- **手机号**: 17737104515
- **预期结果**: 显示"乘车人添加成功！"消息

#### 2. 添加学生乘客（用户3）
- **姓名**: 舒明亮
- **身份证号**: 230107200207012842
- **手机号**: 15283167110
- **预期结果**: 显示"乘车人添加成功！"消息

#### 3. 添加儿童乘客（用户4）
- **姓名**: 倪雪莲
- **身份证号**: 341817201707016024
- **手机号**: 13834952101
- **预期结果**: 显示"乘车人添加成功！"消息

### 错误测试用例

#### 1. 尝试为已满用户添加乘客（用户1）
- **测试**: 用户1尝试添加任何乘客
- **预期结果**: 显示"已达到最大乘车人数量限制（3人），无法继续添加"

#### 2. 添加不存在的乘客
- **姓名**: 不存在的乘客
- **身份证号**: 999999999999999999
- **手机号**: 13800000000
- **预期结果**: 显示"该乘车人信息无效，请检查姓名、身份证号和手机号是否正确"

#### 3. 添加已关联的乘客
- **测试**: 重复添加同一个乘客
- **预期结果**: 显示"该乘车人已被添加，请勿重复添加"

#### 4. 信息不匹配的乘客
- **姓名**: 郑永军
- **身份证号**: 531318196507019109
- **手机号**: 13834952101（错误的手机号）
- **预期结果**: 显示"该乘车人信息无效，请检查姓名、身份证号和手机号是否正确"

#### 5. 表单验证错误
- **测试**: 不填写姓名或身份证号
- **预期结果**: 显示"请填写完整信息"

## 测试页面

### 1. 提交订单页面
- **路径**: `/submit-order`
- **测试**: 在乘客信息区域点击"添加乘车人"按钮
- **功能**: 验证弹窗权限检查和添加功能

### 2. 个人中心页面
- **路径**: `/profile`
- **测试**: 在关联乘车人卡片中点击"添加乘车人"按钮
- **功能**: 验证弹窗权限检查和添加功能

## 测试步骤

### 1. 弹窗权限检查测试
1. 访问提交订单页面或个人中心页面
2. 点击"添加乘车人"按钮
3. 观察是否打开弹窗或显示警告消息
4. 验证消息内容是否正确

### 2. 添加功能测试
1. 确保用户未达到上限（少于3个乘车人）
2. 点击"添加乘车人"按钮打开弹窗
3. 填写乘客信息（姓名、身份证号、手机号）
4. 点击"添加乘车人"按钮
5. 验证添加结果和提示消息

### 3. 错误处理测试
1. 测试各种错误情况
2. 验证错误消息是否准确和友好
3. 确认表单验证正常工作

## 验证要点

### 1. 弹窗权限检查
- ✅ 达到上限的用户无法打开弹窗
- ✅ 未达到上限的用户可以正常打开弹窗
- ✅ 权限检查失败时显示适当的错误消息

### 2. 添加功能
- ✅ 成功添加时显示成功消息
- ✅ 弹窗自动关闭，表单清空
- ✅ 各种错误情况显示具体的错误消息

### 3. 用户体验
- ✅ 加载状态显示"添加中..."
- ✅ 按钮在提交过程中禁用
- ✅ 错误提示清晰明确，用户友好

## 注意事项

1. **测试用户ID**: 所有测试都使用userId=1
2. **权限检查**: 每次点击添加按钮都会先检查权限
3. **错误处理**: 前后端都有完善的错误处理机制
4. **用户体验**: 提供清晰的权限检查和错误提示
5. **数据一致性**: 后端会验证乘客信息与数据库记录的一致性 