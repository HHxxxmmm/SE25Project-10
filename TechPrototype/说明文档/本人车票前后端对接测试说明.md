# 本人车票前后端对接测试说明

## 功能概述

本人车票页面已经完成前后端对接，主要功能包括：

1. **获取本人车票列表** - 根据用户ID获取所有车票
2. **按状态筛选车票** - 支持按车票状态筛选（待支付、未使用、已使用、已改签、已退票）
3. **显示车票详细信息** - 包括车次、出发/到达站、时间、座位、票价等
4. **显示用户信息** - 显示真实的用户和乘客信息

## 后端API接口

### 1. 获取本人车票
- **URL**: `GET /api/ticket/my-tickets?userId={userId}`
- **参数**: userId (用户ID)
- **响应**: MyTicketResponse

### 2. 按状态获取车票
- **URL**: `GET /api/ticket/my-tickets/status?userId={userId}&ticketStatus={status}`
- **参数**: 
  - userId (用户ID)
  - ticketStatus (车票状态: 0-待支付, 1-未使用, 2-已使用, 3-已退票, 4-已改签)
- **响应**: MyTicketResponse

## 数据结构

### MyTicketResponse
```json
{
  "status": "SUCCESS",
  "message": "获取成功",
  "tickets": [
    {
      "ticketId": 1,
      "ticketNumber": "T202507040001",
      "orderId": 1,
      "orderNumber": "O202507040001",
      "trainId": 1,
      "trainNumber": "G101",
      "departureStopId": 1,
      "departureStationName": "北京南站",
      "arrivalStopId": 2,
      "arrivalStationName": "天津站",
      "travelDate": "2025-07-04",
      "departureTime": "08:00:00",
      "arrivalTime": "09:30:00",
      "carriageNumber": "3",
      "seatNumber": "1A",
      "carriageTypeName": "二等座",
      "price": 168.00,
      "ticketStatus": 1,
      "ticketStatusText": "未使用",
      "ticketType": 1,
      "ticketTypeText": "成人票",
      "createdTime": "2025-07-04T10:00:00",
      "paymentTime": "2025-07-04T10:05:00",
      "orderStatusText": "已支付"
    }
  ],
  "userInfo": {
    "userId": 1,
    "realName": "张三",
    "phoneNumber": "13800138000",
    "email": "zhangsan@example.com",
    "passengerId": 327,
    "passengerName": "张三",
    "passengerIdCard": "110101199001011234",
    "passengerPhone": "13800138000"
  },
  "timestamp": "2025-07-04T10:30:00"
}
```

## 前端功能

### 1. 状态筛选
前端提供了6个筛选按钮：
- **全部** - 显示所有车票
- **待支付** - 只显示待支付的车票
- **未使用** - 只显示未使用的车票
- **已使用** - 只显示已使用的车票
- **已改签** - 只显示已改签的车票
- **已退票** - 只显示已退票的车票

### 2. 车票信息显示
每张车票显示以下信息：
- 出行日期
- 车次号
- 出发站和出发时间
- 到达站和到达时间
- 车票状态
- 席别（车厢类型）
- 票种
- 车厢座位
- 票价

### 3. 用户信息显示
页面顶部显示真实的用户信息：
- 乘客姓名
- 身份证号
- 手机号

### 4. 分页功能
- 每页显示10张车票
- 支持分页导航

## 测试步骤

### 1. 启动后端服务
```bash
cd TechPrototype
mvn spring-boot:run
```

### 2. 启动前端服务
```bash
cd mini-12306
npm start
```

### 3. 测试API接口
使用Postman或其他工具测试以下接口：

#### 获取所有车票
```
GET http://localhost:8080/api/ticket/my-tickets?userId=1
```

#### 按状态获取车票
```
GET http://localhost:8080/api/ticket/my-tickets/status?userId=1&ticketStatus=1
```

### 4. 测试前端页面
1. 打开浏览器访问 `http://localhost:3000`
2. 点击左侧导航栏的"本人车票"
3. 验证页面顶部显示的用户信息是否正确
4. 测试各种状态筛选功能
5. 验证车票信息显示是否正确

## 注意事项

1. **用户ID**: 目前前端使用固定的测试用户ID (1)，实际项目中应该从用户认证状态获取
2. **数据依赖**: 需要确保数据库中有对应的用户、乘客、车票数据
3. **时间格式**: 后端返回的时间格式为 `HH:mm:ss`，前端会自动格式化显示
4. **错误处理**: 前端包含完整的错误处理和加载状态显示
5. **用户信息**: 后端会从数据库中获取真实的用户和乘客信息

## 数据库要求

确保数据库中有以下数据：
- users表：用户信息（userId=1的用户）
- passengers表：乘客信息（与用户关联的乘客）
- tickets表：车票信息
- train_stops表：列车停靠站点信息
- stations表：车站信息
- trains表：列车信息
- carriage_types表：车厢类型信息

## 数据流程

1. 前端发送请求，包含userId=1
2. 后端根据userId查询用户信息
3. 后端根据用户的passengerId查询乘客信息
4. 后端根据passengerId查询车票信息
5. 后端从train_stops表获取出发和到达时间
6. 后端返回完整的用户信息和车票列表
7. 前端显示真实的用户信息和车票数据

## 后续优化

1. **用户认证**: 集成真实的用户认证系统
2. **缓存优化**: 对频繁查询的数据进行缓存
3. **分页优化**: 后端支持分页查询
4. **搜索功能**: 添加车票搜索功能
5. **导出功能**: 支持车票信息导出 