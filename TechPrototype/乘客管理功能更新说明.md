# 乘客管理功能更新说明

## 更新内容

### 1. 移除乘客类型字段
- **修改文件**: `AddPassengerRequest.java`
- **变更**: 移除了 `passengerType` 字段
- **原因**: 系统将直接使用数据库中乘客的真实类型，不再需要前端传递乘客类型

### 2. 简化验证逻辑
- **修改文件**: `PassengerManagementServiceImpl.java`
- **变更**: 
  - 移除了 `validatePassengerType` 方法
  - 移除了乘客类型验证逻辑
  - 简化了添加乘客的流程
- **原因**: 不再需要验证乘客类型匹配，系统直接使用数据库中的真实类型

### 3. 更新Postman测试集合
- **新增文件**: `postman_passenger_management_updated.json`
- **变更**: 移除了所有请求中的 `passengerType` 字段
- **原因**: 保持测试用例与实际API的一致性

## 修改后的API行为

### 添加乘客请求格式
```json
{
  "userId": 2,
  "realName": "郑永军",
  "idCardNumber": "531318196507019109",
  "phoneNumber": "17737104515"
}
```

### 验证逻辑
1. **用户验证**: 检查用户是否存在，是否已达到最大关联乘客数量（3人）
2. **乘客验证**: 根据身份证号查找乘客，验证姓名、身份证号、手机号是否匹配
3. **关系验证**: 检查该乘客是否已被该用户关联
4. **类型使用**: 直接使用数据库中乘客的真实类型，不进行类型转换

### 乘客类型规则
- **成人**: 只能添加为成人
- **儿童**: 只能添加为儿童  
- **学生**: 只能添加为学生
- **军人**: 只能添加为军人
- **残疾**: 只能添加为残疾

## 测试用例更新

### 正常测试用例
1. **添加成人乘客**: 用户2添加郑永军（成人）
2. **添加学生乘客**: 用户3添加舒明亮（学生）
3. **添加儿童乘客**: 用户4添加倪雪莲（儿童）
4. **添加军人乘客**: 用户5添加庞宝林（军人）
5. **添加残疾乘客**: 用户6添加毛丽霞（残疾）

### 错误测试用例
1. **用户已满**: 尝试为已有3个关联乘客的用户添加乘客
2. **乘客不存在**: 尝试添加不存在的乘客
3. **已关联**: 尝试添加已关联的乘客
4. **信息不匹配**: 尝试添加信息不匹配的乘客

## 影响范围

### 前端修改
- 移除添加乘客表单中的乘客类型选择字段
- 更新API调用，不再传递 `passengerType` 参数

### 后端修改
- 简化了验证逻辑
- 提高了系统性能（减少了类型验证）
- 确保了数据一致性（直接使用数据库中的真实类型）

## 优势

1. **简化流程**: 减少了前端的复杂度，不需要选择乘客类型
2. **数据一致性**: 确保乘客类型与数据库中的真实类型一致
3. **减少错误**: 避免了因类型选择错误导致的问题
4. **提高性能**: 减少了验证逻辑，提高了响应速度

## 注意事项

1. **数据库依赖**: 系统完全依赖数据库中的乘客类型信息
2. **前端适配**: 需要更新前端代码，移除乘客类型选择功能
3. **测试更新**: 需要更新所有相关的测试用例
4. **文档更新**: 需要更新API文档和用户手册 